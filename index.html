<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ID Photo 4×6 Layout • 35×45 mm</title>
<style>
:root{
 --bg:#0b0c10;--panel:#14161b;--muted:#9095a0;--text:#e9edf1;
 --acc:#6ee7b7;--acc2:#8ab4f8;--border:#252a33;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;
 background:var(--bg);color:var(--text)}
.wrap{max-width:1100px;margin:24px auto;padding:0 16px}
header{display:flex;gap:12px;align-items:center;margin-bottom:16px;flex-wrap:wrap}
header h1{font-size:20px;margin:0}
.badge{background:#1f2937;color:#cbd5e1;padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid var(--border)}
.version{background:#272a32;color:#a5b4fc;border:1px solid #383d47;padding:4px 10px;border-radius:999px;font-size:12px}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px}
.controls{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;align-items:end}
.field{display:flex;flex-direction:column;gap:6px;grid-column:span 3}
.field.full{grid-column:1/-1}
label{font-size:12px;color:var(--muted)}
select,button{appearance:none;border:1px solid var(--border);
 background:#0f1116;color:#e9edf1;border-radius:10px;
 padding:10px 12px;font-size:14px}
button.primary{background:linear-gradient(135deg,var(--acc2),var(--acc));color:#0b0c10;border:none;font-weight:600}
.row{display:flex;gap:10px;flex-wrap:wrap}
.drop{border:2px dashed #2b323d;border-radius:12px;padding:18px;
 text-align:center;color:#cbd5e1;cursor:pointer;background:#0f1116;
 transition:border-color .2s}
.drop.drag{border-color:var(--acc);background:#0e161f}
.preview{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px}
canvas{width:100%;height:auto;background:white;border-radius:12px;border:1px solid var(--border)}
.note{color:#aab1bc;font-size:12px}
footer{margin:24px 0;color:#9aa3af;font-size:12px}
.pill{padding:2px 8px;border-radius:999px;border:1px solid var(--border);color:#cbd5e1;font-size:12px}
#file{display:none}
</style>
</head>
<body>
<div class="wrap">
<header>
  <h1>ID Photo 4×6 Layout</h1>
  <span class="badge">35×45 mm • 3×2 grid</span>
  <span class="pill">Works offline • No upload</span>
  <span class="version" id="versionTag"></span>
</header>

<section class="panel">
  <div class="controls">
    <div class="field" style="grid-column:span 6">
      <label>Upload or drag & drop image</label>
      <label id="drop" class="drop">
        Drop image here or click to choose
        <input id="file" type="file" accept="image/*">
      </label>
      <div class="note">Each cell = 35×45 mm • Auto-layout (3×2) • 600 DPI fixed.</div>
    </div>

    <div class="field full">
      <div class="row">
        <button id="render" class="primary">Render 4×6 Sheet</button>
        <button id="downloadJpg">Download JPEG</button>
        <button id="printBtn">Print</button>
        <button id="resetBtn">Reset</button>
        <span class="note">⚙️ Print: Scale 100 % • Paper 4×6 in • Borderless OFF</span>
      </div>
    </div>
  </div>

  <div class="preview">
    <canvas id="canvas" width="3600" height="2400"></canvas>
  </div>
</section>

<footer>Made for Canon SELPHY CP1500 — Use Actual Size (100 %) for true 35×45 mm prints.</footer>
</div>

<script>
(function(){
const now=new Date();
const m=now.toLocaleString("default",{month:"short"});
document.getElementById("versionTag").textContent=`v${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,"0")}.${String(now.getDate()).padStart(2,"0")} — ${m} ${now.getDate()}`;

const fileInput=document.getElementById("file"),
drop=document.getElementById("drop"),
canvas=document.getElementById("canvas"),
ctx=canvas.getContext("2d"),
renderBtn=document.getElementById("render"),
downloadBtn=document.getElementById("downloadJpg"),
printBtn=document.getElementById("printBtn"),
resetBtn=document.getElementById("resetBtn");

const DPI=600;
const mmToIn=mm=>mm/25.4,inToPx=(mm)=>Math.round(mmToIn(mm)*DPI);
let loadedImg=null;

function computeLayout(){
 const W=inToPx(152.4),H=inToPx(101.6); // 4×6 in
 canvas.width=W;canvas.height=H;
 const pw=inToPx(35),ph=inToPx(45);
 const cols=3,rows=2;
 const totalW=cols*pw,totalH=rows*ph;
 const gapX=(W-totalW)/(cols+1),gapY=(H-totalH)/(rows+1);
 const positions=[];
 for(let r=0;r<rows;r++){
  for(let c=0;c<cols;c++){
   positions.push({x:Math.round(gapX*(c+1)+pw*c),y:Math.round(gapY*(r+1)+ph*r)});
  }
 }
 return{W,H,pw,ph,positions,gapX,gapY};
}

function drawImage(img,x,y,w,h){
 const iw=img.naturalWidth,ih=img.naturalHeight,ir=iw/ih,cr=w/h;
 let dw=w,dh=h,dx=x,dy=y;
 if(ir>cr){dh=h;dw=h*ir;dx=x+(w-dw)/2;}
 else{dw=w;dh=w/ir;dy=y+(h-dh)/2;}
 ctx.imageSmoothingEnabled=true;
 ctx.imageSmoothingQuality="high";
 ctx.drawImage(img,dx,dy,dw,dh);
}

function drawCuts(layout){
 const {positions,pw,ph}=layout;
 ctx.save();
 ctx.strokeStyle="#000";
 ctx.lineWidth=2;
 ctx.beginPath();
 for(let p of positions){
  const x=p.x,y=p.y;
  ctx.moveTo(x,0);ctx.lineTo(x,p.y);           // vertical
  ctx.moveTo(x+pw,0);ctx.lineTo(x+pw,p.y);
  ctx.moveTo(0,y);ctx.lineTo(p.x,y);           // horizontal
  ctx.moveTo(0,y+ph);ctx.lineTo(p.x,y+ph);
 }
 ctx.stroke();
 ctx.restore();
}

function render(){
 if(!loadedImg){alert("Please upload an image first.");return;}
 const layout=computeLayout();
 ctx.fillStyle="#fff";ctx.fillRect(0,0,layout.W,layout.H);
 for(const p of layout.positions) drawImage(loadedImg,p.x,p.y,layout.pw,layout.ph);
 drawCuts(layout);
}

function downloadJPEG(){
 const a=document.createElement("a");
 a.href=canvas.toDataURL("image/jpeg",0.95);
 a.download="ID-4x6-layout.jpg";a.click();
}

function openPrint(){
 const imgURL=canvas.toDataURL("image/png");
 const w=window.open("","_blank");
 const html=`<!DOCTYPE html><html><head><meta charset='utf-8'><style>@page{size:6in 4in;margin:0}body{margin:0;display:flex;justify-content:center;align-items:center;background:#fff}img{width:6in;height:4in;}</style></head><body><img src='${imgURL}'><script>window.onload=()=>{alert("Ensure: Scale 100 % + Borderless OFF for true size!");window.print()}<\\/script></body></html>`;
 w.document.write(html);w.document.close();
}

function reset(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle="#fff";ctx.fillRect(0,0,canvas.width,canvas.height);
 loadedImg=null;
 const ni=fileInput.cloneNode(true);
 fileInput.parentNode.replaceChild(ni,fileInput);
 ni.addEventListener("change",e=>load(e.target.files[0]));
 drop.textContent="Drop image here or click to choose";
}

function load(f){
 if(!f.type.startsWith("image/"))return alert("Select an image");
 const url=URL.createObjectURL(f),img=new Image();
 img.onload=()=>{loadedImg=img;URL.revokeObjectURL(url);drop.textContent=f.name+" ✓";render();};
 img.src=url;
}

drop.addEventListener("dragover",e=>{e.preventDefault();drop.classList.add("drag")});
drop.addEventListener("dragleave",()=>drop.classList.remove("drag"));
drop.addEventListener("drop",e=>{
 e.preventDefault();drop.classList.remove("drag");
 if(e.dataTransfer.files[0])load(e.dataTransfer.files[0]);
});
fileInput.addEventListener("change",e=>{if(e.target.files[0])load(e.target.files[0]);});
renderBtn.onclick=render;
downloadBtn.onclick=downloadJPEG;
printBtn.onclick=openPrint;
resetBtn.onclick=reset;
})();
</script>
</body>
</html>
