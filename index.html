<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ID Photo 4×6 Layout • 35×45 mm</title>
<style>
:root{
 --bg:#0b0c10;--panel:#14161b;--muted:#9095a0;--text:#e9edf1;
 --acc:#6ee7b7;--acc2:#8ab4f8;--border:#252a33;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;
 background:var(--bg);color:var(--text)}
.wrap{max-width:1100px;margin:24px auto;padding:0 16px}
header{display:flex;gap:12px;align-items:center;margin-bottom:16px;flex-wrap:wrap}
header h1{font-size:20px;margin:0}
.badge{background:#1f2937;color:#cbd5e1;padding:4px 10px;
 border-radius:999px;font-size:12px;border:1px solid var(--border)}
.version{background:#272a32;color:#a5b4fc;border:1px solid #383d47;
 padding:4px 10px;border-radius:999px;font-size:12px}
.panel{background:var(--panel);border:1px solid var(--border);
 border-radius:14px;padding:16px}
.controls{display:grid;grid-template-columns:repeat(12,1fr);
 gap:12px;align-items:end}
.field{display:flex;flex-direction:column;gap:6px;grid-column:span 3}
.field.full{grid-column:1/-1}
label{font-size:12px;color:var(--muted)}
select,button,input[type="checkbox"]{appearance:none;border:1px solid var(--border);
 background:#0f1116;color:#e9edf1;border-radius:10px;
 padding:10px 12px;font-size:14px}
input[type="checkbox"]{width:auto;transform:scale(1.3);margin-right:8px;vertical-align:middle}
button.primary{background:linear-gradient(135deg,var(--acc2),var(--acc));
 color:#0b0c10;border:none;font-weight:600}
button:disabled{opacity:.5}
.row{display:flex;gap:10px;flex-wrap:wrap}
.drop{border:2px dashed #2b323d;border-radius:12px;padding:18px;
 text-align:center;color:#cbd5e1;cursor:pointer;background:#0f1116;
 transition:border-color .2s}
.drop.drag{border-color:var(--acc);background:#0e161f}
.preview{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px}
canvas{width:100%;height:auto;background:white;border-radius:12px;
 border:1px solid var(--border)}
.note{color:#aab1bc;font-size:12px}
footer{margin:24px 0;color:#9aa3af;font-size:12px}
.pill{padding:2px 8px;border-radius:999px;border:1px solid var(--border);
 color:#cbd5e1;font-size:12px}
#file{display:none}
</style>
</head>
<body>
<div class="wrap">
<header>
  <h1>ID Photo 4×6 Layout</h1>
  <span class="badge">35×45 mm • 3×2 grid</span>
  <span class="pill">Works offline • No upload</span>
  <span class="version" id="versionTag"></span>
</header>

<section class="panel">
  <div class="controls">
    <div class="field" style="grid-column:span 6">
      <label>Upload or drag & drop image</label>
      <label id="drop" class="drop">
        Drop image here or click to choose
        <input id="file" type="file" accept="image/*">
      </label>
      <div class="note">
        Tip: use a properly cropped headshot (35×45 mm aspect ≈ 0.78).  
        The app will place 6 copies automatically.
      </div>
    </div>

    <!-- DPI locked to 600 (control disabled to avoid accidental change) -->
    <div class="field"><label>DPI</label>
      <select id="dpi" disabled>
        <option value="600" selected>600 dpi (locked)</option>
      </select>
    </div>

    <div class="field"><label>Photo size</label>
      <select id="sizePreset">
        <option value="35x45mm" selected>35×45 mm</option>
        <option value="50x50mm">50×50 mm</option>
        <option value="2x2in">2×2 in</option>
      </select></div>

    <div class="field"><label>Fit mode</label>
      <select id="fitMode">
        <option value="cover" selected>Fill cell — may crop</option>
        <option value="contain">Fit inside — may leave margins</option>
      </select></div>

    <!-- Tick length/position are not used for dashed full lines; keeping for layout consistency -->
    <div class="field"><label>Tick length (unused)</label>
      <select id="tickLen" disabled>
        <option value="90" selected>—</option>
      </select></div>

    <div class="field"><label>Tick thickness</label>
      <select id="tickThick">
        <option value="1" selected>1 px</option>
        <option value="2">2 px</option>
        <option value="3">3 px</option>
      </select></div>

    <div class="field"><label>Tick color</label>
      <select id="tickColor">
        <option value="#000000" selected>Black</option>
        <option value="#555555">Gray</option>
        <option value="#ff0000">Red</option>
      </select></div>

    <div class="field"><label>Tick position (unused)</label>
      <select id="tickPos" disabled>
        <option value="outside" selected>—</option>
      </select></div>

    <div class="field full">
      <label style="display:flex;align-items:center">
        <input type="checkbox" id="borderToggle">
        Show white border frame around each photo
      </label>
    </div>

    <div class="field full">
      <div class="row">
        <button id="render" class="primary">Render 4×6 Sheet</button>
        <button id="downloadJpg">Download JPEG</button>
        <button id="printBtn">Print</button>
        <button id="resetBtn">Reset layout</button>
        <span class="note">Print: Paper 4×6 (10×15 cm), Scale 100%, Borderless OFF.</span>
      </div>
    </div>
  </div>

  <div class="preview">
    <canvas id="canvas" width="3600" height="2400"></canvas>
    <div class="panel" style="background:#0f1116">
      <h3 style="margin-top:0;font-size:14px;color:#cbd5e1">What it does</h3>
      <ul style="margin-top:6px;line-height:1.6;color:#cbd5e1;padding-left:18px">
        <li>True 4×6 inch sheet at <b>600 dpi</b> (locked)</li>
        <li>Places six copies of your photo (35×45 mm each)</li>
        <li><b>Dashed cut lines (6 on 3)</b> on all 6 verticals and top/bottom horizontals</li>
        <li>Optional white frame borders for trimming clarity</li>
        <li>All local — no upload</li>
      </ul>
    </div>
  </div>
</section>

<footer>Made for Canon SELPHY CP1500. Keep Borderless OFF for exact sizes & marks.</footer>
</div>

<script>
(function(){
// === Dynamic version badge ===
const now=new Date();
const month=now.toLocaleString("default",{month:"2-digit"});
const day=String(now.getDate()).padStart(2,"0");
const year=now.getFullYear();
const VERSION_NUMBER=`v${year}.${month}.${day}`;
const monthName=now.toLocaleString("default",{month:"short"});
document.getElementById("versionTag").textContent=
 `${VERSION_NUMBER} — Updated ${monthName} ${day}, ${year}`;

// === Core logic ===
const fileInput=document.getElementById("file"),
drop=document.getElementById("drop"),
sizePreset=document.getElementById("sizePreset"),
fitModeSel=document.getElementById("fitMode"),
tickThickSel=document.getElementById("tickThick"),
tickColorSel=document.getElementById("tickColor"),
borderToggle=document.getElementById("borderToggle"),
renderBtn=document.getElementById("render"),
downloadBtn=document.getElementById("downloadJpg"),
printBtn=document.getElementById("printBtn"),
resetBtn=document.getElementById("resetBtn"),
canvas=document.getElementById("canvas"),
ctx=canvas.getContext("2d");

// Force 600 dpi everywhere
const DPI = 600;
const mmToIn=mm=>mm/25.4,inToPx=(inch,dpi)=>Math.round(inch*dpi);

let loadedImg=null;

function getPhotoSizePx(preset){
 switch(preset){
  case"50x50mm":return{w:inToPx(mmToIn(50),DPI),h:inToPx(mmToIn(50),DPI)};
  case"2x2in":return{w:inToPx(2,DPI),h:inToPx(2,DPI)};
  default:return{w:inToPx(mmToIn(35),DPI),h:inToPx(mmToIn(45),DPI)};
 }
}

function computeLayout(){
 // Canvas already 3600x2400 (6x4 inches at 600 dpi)
 const W=3600, H=2400;
 const nCols=3, nRows=2, sz=getPhotoSizePx(sizePreset.value);

 // Center images with equal gutters
 const usedW=nCols*sz.w, usedH=nRows*sz.h;
 const gapX=(W-usedW)/(nCols+1), gapY=(H-usedH)/(nRows+1);

 // Left/top of each cell
 const startsX=[0,1,2].map(c=>Math.round(gapX*(c+1)+sz.w*c));
 const startsY=[0,1].map(r=>Math.round(gapY*(r+1)+sz.h*r));

 // Build edge arrays: 6 vertical (L,R for each col), 4 horizontal (T,B for each row)
 const V=[]; // 6 items
 for(let c=0;c<nCols;c++){
   const left = startsX[c];
   const right = left + sz.w;
   V.push(Math.round(left), Math.round(right));
 }
 const Hs=[]; // 4 items
 for(let r=0;r<nRows;r++){
   const top = startsY[r];
   const bottom = top + sz.h;
   Hs.push(Math.round(top), Math.round(bottom));
 }

 return {W,H,sz,gapX,gapY,startsX,startsY,V,Hs};
}

function drawImageInCell(img,x,y,w,h,fit){
 const iw=img.naturalWidth, ih=img.naturalHeight, ir=iw/ih, cr=w/h;
 let dw=w, dh=h, dx=x, dy=y;
 if(fit==="contain"){
  if(ir>cr){dw=w; dh=w/ir; dy=y+(h-dh)/2;}
  else{dh=h; dw=h*ir; dx=x+(w-dw)/2;}
 }else{ // cover
  if(ir>cr){dh=h; dw=h*ir; dx=x+(w-dw)/2;}
  else{dw=w; dh=w/ir; dy=y+(h-dh)/2;}
 }
 ctx.imageSmoothingEnabled=true; ctx.imageSmoothingQuality="high";
 ctx.drawImage(img,dx,dy,dw,dh);
}

function placePhotos(img,layout,fit,border){
 const {W,H,sz,startsX,startsY}=layout;
 ctx.fillStyle="#fff"; ctx.fillRect(0,0,W,H);
 for(let r=0;r<2;r++){
  for(let c=0;c<3;c++){
   const x=startsX[c];
   const y=startsY[r];
   drawImageInCell(img,x,y,sz.w,sz.h,fit);
   if(border){
     ctx.strokeStyle="#ffffff";
     ctx.lineWidth=Math.max(1,Math.round(sz.w/100));
     ctx.strokeRect(x,y,sz.w,sz.h);
   }
  }
 }
}

// Dashed cut lines (6 on / 3 off) on all vertical & horizontal edges
function drawDashedCuts(layout,{color,t}){
 const {V,Hs}=layout;
 ctx.save();
 ctx.strokeStyle=color;
 ctx.lineWidth=t;
 ctx.setLineDash([6,3]); // your requested pattern

 ctx.beginPath();
 // Vertical lines: all 6 edges (L/R of each column)
 for(let i=0;i<V.length;i++){
   const x=V[i];
   ctx.moveTo(x, Hs[0]-50);              // extend a bit beyond
   ctx.lineTo(x, Hs[Hs.length-1]+50);
 }
 // Horizontal lines: all 4 edges (T/B of each row)
 for(let j=0;j<Hs.length;j++){
   const y=Hs[j];
   ctx.moveTo(V[0]-50, y);
   ctx.lineTo(V[V.length-1]+50, y);
 }
 ctx.stroke();

 ctx.restore();
}

function render(){
 if(!loadedImg){alert("Please upload an image first.");return;}
 const layout=computeLayout();            // 600 dpi layout
 placePhotos(loadedImg,layout,fitModeSel.value,borderToggle.checked);
 const t=parseInt(tickThickSel.value,10); // thickness
 const color=tickColorSel.value;          // color
 drawDashedCuts(layout,{color,t});
}

function downloadJPEG(){
 const url=canvas.toDataURL("image/jpeg",0.95);
 const a=document.createElement("a");a.href=url;a.download="ID-4x6-layout.jpg";
 document.body.appendChild(a);a.click();a.remove();
}

function openPrint(){
 const imgURL=canvas.toDataURL("image/png");
 const w=window.open("","_blank");
 const html=`<!DOCTYPE html><html><head><meta charset='utf-8'>
 <title>Print 4×6</title>
 <style>@page{size:6in 4in;margin:0}body{margin:0;display:flex;
 align-items:center;justify-content:center;background:#fff}
 img{width:6in;height:4in;image-rendering:-webkit-optimize-contrast}</style>
 </head><body><img src='${imgURL}' alt='layout'>
 <script>window.onload=()=>window.print()<\\/script></body></html>`;
 w.document.open();w.document.write(html);w.document.close();
}

function resetLayout(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle="#fff";ctx.fillRect(0,0,canvas.width,canvas.height);
 loadedImg=null;
 // Recreate file input so you can reselect same file name
 const newInput=fileInput.cloneNode(true);
 fileInput.parentNode.replaceChild(newInput,fileInput);
 newInput.addEventListener("change",e=>{
  const f=e.target.files?.[0];if(f)loadFile(f);
 });
 drop.textContent="Drop image here or click to choose";
 newInput.value="";
 // reset other UI
 sizePreset.value="35x45mm";
 fitModeSel.value="cover";
 tickThickSel.value="1";
 tickColorSel.value="#000000";
 borderToggle.checked=false;
}

drop.addEventListener("dragover",e=>{e.preventDefault();drop.classList.add("drag")});
drop.addEventListener("dragleave",()=>drop.classList.remove("drag"));
drop.addEventListener("drop",e=>{
 e.preventDefault();drop.classList.remove("drag");
 const f=e.dataTransfer.files?.[0];if(f)loadFile(f);
});
fileInput.addEventListener("change",e=>{
 const f=e.target.files?.[0];if(f)loadFile(f);
});

function loadFile(f){
 if(!f.type.startsWith("image/")){alert("Choose an image.");return;}
 const url=URL.createObjectURL(f); const img=new Image();
 img.onload=()=>{loadedImg=img;URL.revokeObjectURL(url);
 drop.textContent=f.name+" ✓ (click to change)";
 render(); fileInput.value="";};
 img.src=url;
}

// live re-render on setting change
[sizePreset,fitModeSel,tickThickSel,tickColorSel,borderToggle]
.forEach(el=>el.addEventListener("change",()=>{if(loadedImg)render();}));

renderBtn.onclick=render;
downloadBtn.onclick=downloadJPEG;
printBtn.onclick=openPrint;
resetBtn.onclick=resetLayout;
})();
</script>
</body>
</html>
